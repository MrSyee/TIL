# Web Socket

- 웹 소켓은 하나의 TCP 접속에 전이중 통신 채널(양방향)을 제공하는 컴퓨터 통신 프로토콜이다.
- HTTP, HTTPS 위에서 동작하도록 설계되어있다.
- 웹 소켓은 TCP에 의존하지만 HTTP에 기반하므로 7계층에 위치한다.
- 7계층에 기반하기 때문에 메시지 형식의 데이터를 다룬다.
- 평문 메시지 전송방식이기 때문에, SSL/TLS 보안 계층으로 암호화되어야 데이터 탈취를 방지할 수 있다.

## 소켓 통신과 비교
- 소켓은 네트워크 상에서 동작하는 프로그램 간 통신의 종착점을 말하며, 대부분의 통신은 인터넷 프로토콜(TCP, UDP)에 기반하고 있기 때문에 대부분의 네트워크 소켓은 인터넷 소켓이다.
- 소켓은 인터넷 프로토콜에 기반하므로 4계층에 위치한다.
- 웹에서도 TCP 소켓 통신으로 실시간 통신을 할 수는 있지만, 전송 계층(4계층)의 원시 바이트로 데이터를 주고 받기 보다 애플리케이션 계층을 통해 메시지 형태의 데이터를 주고 받는 것이 개발 측면에서 더 적합하기 때문에 TCP 소켓통신에 기반하여 웹 소켓이 발전되었다.
- **즉, 웹 소켓은 TCP 소켓의 추상화된 개념이다**

## 다른 방식과 비교
- Pooling
  - 브라우저가 일정한 주기마다 서버에 HTTP 요청을 보내고 응답을 받는다.
  - 주기가 짧을수록 실시간성이 높아지지만, 서버 및 네트워크 부하가 같이 높아진다.
  - 실시간성이 떨어지더라도 주기를 늘려 여러 대의 클라이언트와 통신할 때 적합하다.
    - 페북 친구 리스트의 온라인 상태 확인, 실시간 야구 문자 중계
- Long Polling
  - Polling 방식과 달리 요청에 대한 응답을 보내고 연결을 바로 끊는 것이 아닌 일정 시간 대기하는 방식.
  - 대기 시간 중에 데이터에 변경이 일어나면 바로 클라이언트에 응답을 보낸다. 응답을 받은 클라이언트는 다시 서버에 요청을 보낸다. (연결이 유지되도록)
  - 계속해서 재연결해야하므로 비교적 많은 클라이언트와의 연결, 데이터 변경이 빈번한 경우 서버에 부담을 줄 수 있다.
  - 실시간성이 필요한 적은 수의 클라이언트에 적합하다.
    - 웹 1:1 채팅, 10명 이하의 단체 채팅
- Server Sent Event(SSE), Streaming
  - 서버가 요청을 받으면 요청에 대한 응답을 완료하지 않은 상태에서 데이터를 계속 보내도록 한다.
  - 클라이언트는 응답을 받더라도 연결이 끊어지지 않는다.
  - 클라이언트에서 서버로 데이터를 보낼 수 없다. 실시간 단방향 통신이다.


## 실습
다운로드 받을 때, 다운로드가 얼마나 되었는지 정도를 Websocket으로 Client에게 알려주는 로직

- server
```
make run
```

- client
```
python client.py
```
```
Download started with task ID: 7310ab4b-236d-44fd-84fe-a80ea4040208
Download progress: 0%
Download progress: 1.0668628656986767%
...
Download completed
Download process completed.
```
